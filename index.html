<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="img/LOGOCHCOCVIA-removebg-preview.png" />
  <title>V√≠as del Choc√≥ - Informaci√≥n en Tiempo Real</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Tailwind CDN (para prototipos sin bundler) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="app"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- App en JSX (transpilado por Babel en el cliente). Ideal para prototipos. -->
  <script type="text/babel">
// --- inicio App.jsx inline ---
const roadsData = [
  { id: 1, title: "V√≠a Quibd√≥ - Medell√≠n (T√∫nel de Occidente)", status: "Regular", from: "Quibd√≥", to: "Medell√≠n", km: "240 km", desc: "Principal v√≠a que conecta el Choc√≥ con Antioquia. Atraviesa Carmen de Atrato y El Carmen de Atrato.", updated: "2 nov 2025, 10:30 AM" },
  { id: 2, title: "V√≠a Quibd√≥ - Pereira (Anserma - Tad√≥)", status: "Regular", from: "Quibd√≥", to: "Pereira", km: "195 km", desc: "Conecta con Risaralda pasando por Tad√≥. Estado variable seg√∫n temporada de lluvias.", updated: "2 nov 2025, 8:00 AM" },
  { id: 3, title: "V√≠a Quibd√≥ - Istmina - Condoto", status: "Buena", from: "Quibd√≥", to: "Istmina", km: "86 km", desc: "V√≠a intermunicipal que conecta la capital con Istmina y Condoto.", updated: "2 nov 2025, 9:15 AM" },
  { id: 4, title: "V√≠a Quibd√≥ - Llor√≥", status: "Regular", from: "Quibd√≥", to: "Llor√≥", km: "72 km", desc: "Conecta con el municipio de Llor√≥ en la zona del medio San Juan.", updated: "2 nov 2025, 11:00 AM" },
  { id: 5, title: "V√≠a Tad√≥ - Certegui", status: "Mala", from: "Tad√≥", to: "Certegui", km: "45 km", desc: "V√≠a en mal estado que requiere mantenimiento constante.", updated: "1 nov 2025, 4:45 PM" },
  { id: 6, title: "V√≠a Istmina - R√≠o Ir√≥", status: "Buena", from: "Istmina", to: "R√≠o Ir√≥", km: "32 km", desc: "V√≠a hacia la zona del R√≠o Ir√≥ en buen estado.", updated: "2 nov 2025, 7:30 AM" },
  { id: 7, title: "V√≠a Carmen de Atrato - Vig√≠a del Fuerte", status: "Regular", from: "Carmen de Atrato", to: "Vig√≠a del Fuerte", km: "55 km", desc: "Conecta con la zona del Atrato medio.", updated: "2 nov 2025, 10:00 AM" },
  { id: 8, title: "V√≠a Quibd√≥ - Uni√≥n Panamericana", status: "Buena", from: "Quibd√≥", to: "Uni√≥n Panamericana", km: "38 km", desc: "V√≠a en buen estado hacia el norte del departamento.", updated: "2 nov 2025, 9:30 AM" }
];
 
const reportsData = [
  { id: 1, title: "V√≠a Quibd√≥ - Medell√≠n (T√∫nel de Occidente)", status: "Regular", location: "Km 145 - 148 (Sector El Carmen de Atrato)", message: "M√∫ltiples baches de tama√±o considerable en el carril derecho. Tr√°nsito lento.", rec: "Reducir velocidad a 30 km/h. Preferiblemente conducir en carril izquierdo.", user: "Carlos M.", time: "Hace 2 h", lat: 5.8521, lng: -75.6521 },
  { id: 2, title: "V√≠a Tad√≥ - Certegui", status: "Mala", location: "Km 22 - 25", message: "V√≠a muy deteriorada con derrumbes menores. Superficie completamente destruida.", rec: "Solo veh√≠culos 4x4. Evitar en √©poca de lluvia. Llevar tiempo extra de viaje.", user: "Mar√≠a L.", time: "Hace 3 h", lat: 5.7821, lng: -76.2389 },
  { id: 3, title: "V√≠a Quibd√≥ - Pereira (Anserma - Tad√≥)", status: "Cerrada", location: "Km 78 (Sector La Lorena)", message: "Deslizamiento grande bloqueando completamente ambos carriles. Maquinaria trabajando.", rec: "V√≠a cerrada totalmente. Usar rutas alternas. Estimar reapertura en 3-4 d√≠as.", user: "Jorge P.", time: "Hace 5 h", lat: 5.6321, lng: -76.0521 },
  { id: 4, title: "V√≠a Quibd√≥ - Istmina - Condoto", status: "Buena", location: "Km 0 - 86 (Todo el trayecto)", message: "V√≠a en excelente estado, recientemente pavimentada. Flujo vehicular normal.", rec: "Condiciones √≥ptimas. Mantener velocidad reglamentaria.", user: "Ana S.", time: "Hace 3 h", lat: 5.6845, lng: -76.4278 },
  { id: 5, title: "V√≠a Quibd√≥ - Llor√≥", status: "Regular", location: "Km 35 - 40", message: "Hundimiento del pavimento en varios puntos. Se√±alizaci√≥n deficiente.", rec: "Conducir con precauci√≥n especialmente de noche. Velocidad m√°xima 40 km/h en este sector.", user: "Pedro R.", time: "Hace 14 h", lat: 5.7234, lng: -75.9876 }
];

// Coordenadas representativas por id de v√≠a (sirven para asignar un punto por defecto
// cuando un usuario crea un reporte desde el formulario y no proporciona lat/lng).
const roadCoords = {
  1: { lat: 5.8521, lng: -75.6521 }, // V√≠a Quibd√≥ - Medell√≠n
  2: { lat: 5.6321, lng: -76.0521 }, // Quibd√≥ - Pereira
  3: { lat: 5.6845, lng: -76.4278 }, // Quibd√≥ - Istmina - Condoto
  4: { lat: 5.7234, lng: -75.9876 }, // Quibd√≥ - Llor√≥
  5: { lat: 5.7821, lng: -76.2389 }, // Tad√≥ - Certegui
  6: { lat: 5.6845, lng: -76.4278 }, // Istmina - R√≠o Ir√≥ (reuso)
  7: { lat: 5.6929, lng: -75.7519 }, // Carmen de Atrato - Vig√≠a del Fuerte (centro)
  8: { lat: 5.6929, lng: -75.7519 }  // Quibd√≥ - Uni√≥n Panamericana (centro)
};
 
function LoginModal({ onClose, onShowRegister, onLogin }) {
  function handleSubmit(e){
    e.preventDefault();
    const form = e.target;
    const email = form.email.value.trim();
    const pass = form.password.value.trim();
    if(!email || !pass){ alert('Ingresa correo y contrase√±a'); return; }
    onLogin(email);
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-gray-50 rounded-lg shadow-2xl w-full max-w-md p-8 relative" style={{backgroundColor:'#f8fafc'}}>
        {/* Bot√≥n X para cerrar */}
        <button 
          onClick={onClose}
          className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition"
        >
          ‚úï
        </button>
        
        <h2 className="text-3xl font-bold mb-6" style={{color:'#030213'}}>Iniciar sesi√≥n</h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label htmlFor="email" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Correo electr√≥nico</label>
            <input 
              id="email" 
              name="email" 
              type="email" 
              placeholder="tu@email.com"
              className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition"
              style={{borderColor:'#bfdbfe', color:'#1a1a1a', backgroundColor:'white', '--tw-ring-color':'#2563eb'}}
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Contrase√±a</label>
            <input 
              id="password" 
              name="password" 
              type="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition"
              style={{borderColor:'#bfdbfe', color:'#1a1a1a', backgroundColor:'white'}}
            />
          </div>
          <div className="flex gap-2 justify-end pt-4">
            <button type="button" onClick={onClose} className="px-4 py-2 font-semibold rounded-lg transition" style={{color:'#717182', backgroundColor:'#efefff'}}>
              Cancelar
            </button>
            <button type="submit" className="px-6 py-2 text-white font-bold rounded-lg transition" style={{backgroundColor:'#030213'}}>
              Entrar
            </button>
          </div>
        </form>
        <p className="text-center text-sm mt-4" style={{color:'#717182'}}>
          ¬øNo tienes cuenta? 
          <button 
            type="button"
            onClick={onShowRegister}
            className="font-semibold hover:underline ml-1 transition"
            style={{color:'#2563eb'}}
          >
            Reg√≠strate aqu√≠
          </button>
        </p>
      </div>
    </div>
  );
}

function RegisterModal({ onClose, onRegister }){
  function handleSubmit(e){
    e.preventDefault();
    const form = e.target;
    const name = form.name.value.trim();
    const email = form.email.value.trim();
    const pass = form.password.value.trim();
    if(!name || !email || !pass){ alert('Completa todos los campos'); return; }
    onRegister(name, email);
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-gray-50 rounded-lg shadow-2xl w-full max-w-md p-8 relative" style={{backgroundColor:'#f8fafc'}}>
        {/* Bot√≥n X para cerrar */}
        <button 
          onClick={onClose}
          className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition"
        >
          ‚úï
        </button>

        <h2 className="text-3xl font-bold mb-6" style={{color:'#030213'}}>Crear cuenta</h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label htmlFor="name" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Nombre completo</label>
            <input 
              id="name" 
              name="name" 
              type="text"
              placeholder="Tu nombre"
              className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition"
              style={{borderColor:'#bfdbfe', color:'#1a1a1a', backgroundColor:'white'}}
            />
          </div>
          <div>
            <label htmlFor="email" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Correo electr√≥nico</label>
            <input 
              id="email" 
              name="email" 
              type="email"
              placeholder="tu@email.com"
              className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition"
              style={{borderColor:'#bfdbfe', color:'#1a1a1a', backgroundColor:'white'}}
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Contrase√±a</label>
            <input 
              id="password" 
              name="password" 
              type="password"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              className="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition"
              style={{borderColor:'#bfdbfe', color:'#1a1a1a', backgroundColor:'white'}}
            />
          </div>
          <div className="flex gap-2 justify-end pt-4">
            <button type="button" onClick={onClose} className="px-4 py-2 font-semibold rounded-lg transition" style={{color:'#717182', backgroundColor:'#efefff'}}>
              Cancelar
            </button>
            <button type="submit" className="px-6 py-2 text-white font-bold rounded-lg transition" style={{backgroundColor:'#030213'}}>
              Registrar
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

function Stats() {
  return (
    <section className="mb-8">
      <h3 className="text-2xl font-bold mb-4" style={{color:'#030213'}}>Estado General de las V√≠as</h3>
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div className="p-4 rounded-lg text-center" style={{backgroundColor:'#f0fdf4', borderLeft:'4px solid #22c55e'}}>
          <div className="text-3xl font-bold" style={{color:'#22c55e'}}>3</div>
          <div className="text-sm font-semibold" style={{color:'#030213'}}>Buenas</div>
        </div>
        <div className="p-4 rounded-lg text-center" style={{backgroundColor:'#fffbeb', borderLeft:'4px solid #eab308'}}>
          <div className="text-3xl font-bold" style={{color:'#eab308'}}>3</div>
          <div className="text-sm font-semibold" style={{color:'#030213'}}>Regulares</div>
        </div>
        <div className="p-4 rounded-lg text-center" style={{backgroundColor:'#fef3c7', borderLeft:'4px solid #f97316'}}>
          <div className="text-3xl font-bold" style={{color:'#f97316'}}>1</div>
          <div className="text-sm font-semibold" style={{color:'#030213'}}>Malas</div>
        </div>
        <div className="p-4 rounded-lg text-center" style={{backgroundColor:'#fee2e2', borderLeft:'4px solid #ef4444'}}>
          <div className="text-3xl font-bold" style={{color:'#ef4444'}}>1</div>
          <div className="text-sm font-semibold" style={{color:'#030213'}}>Cerradas</div>
        </div>
      </div>
    </section>
  );
}

function RoadCard({ road }) {
  const getBadgeColor = (status) => {
    switch(status) {
      case 'Buena': return '#22c55e';
      case 'Regular': return '#eab308';
      case 'Mala': return '#f97316';
      case 'Cerrada': return '#ef4444';
      default: return '#6b7280';
    }
  };

  return (
    <article className="p-4 border rounded-lg shadow-md hover:shadow-lg transition" style={{borderColor:'#e5e7eb', backgroundColor:'white'}}>
      <div className="flex justify-between items-start mb-3">
        <h3 className="font-bold text-lg" style={{color:'#030213'}}>{road.title}</h3>
        <span className="px-3 py-1 rounded-full text-sm font-bold text-white" style={{backgroundColor: getBadgeColor(road.status)}}>
          {road.status}
        </span>
      </div>
      <div className="space-y-2 text-sm mb-3">
        <div><strong style={{color:'#030213'}}>Desde:</strong> {road.from}</div>
        <div><strong style={{color:'#030213'}}>Hasta:</strong> {road.to}</div>
        <div><strong style={{color:'#030213'}}>Distancia:</strong> {road.km}</div>
      </div>
      <p style={{color:'#717182'}} className="mb-3">{road.desc}</p>
      <div className="text-xs" style={{color:'#9ca3af'}}>√öltima actualizaci√≥n: {road.updated}</div>
    </article>
  );
}

function Report({ r, onViewDetails }) {
  const getBadgeColor = (status) => {
    switch(status) {
      case 'Buena': return '#22c55e';
      case 'Regular': return '#eab308';
      case 'Mala': return '#f97316';
      case 'Cerrada': return '#ef4444';
      default: return '#6b7280';
    }
  };
  return (
    <article className="rounded-xl bg-white p-6 shadow-sm hover:shadow-md transition relative overflow-hidden" style={{border: `1px solid ${getBadgeColor(r.status)}22`}}>
      <div className="flex items-start justify-between mb-3">
        <div className="pr-2">
          <h3 className="font-semibold text-lg text-gray-900 mb-1">{r.title}</h3>
          <div className="text-sm text-gray-500">{r.location}</div>
        </div>
        <div className="text-right">
          <div className="text-sm text-gray-500">Distancia</div>
          <div className="font-bold text-gray-900 text-lg">{r.km ? r.km : ''}</div>
        </div>
      </div>

      <div className="mb-3">
        <div className="inline-block px-3 py-1 rounded-full text-xs font-bold text-white" style={{backgroundColor: getBadgeColor(r.status)}}>
          {r.status}
        </div>
      </div>

      <div className="mb-4 text-sm text-gray-700 bg-gray-50 rounded p-3" style={{borderLeft: `4px solid ${getBadgeColor(r.status)}`}}>
        {r.message}
      </div>

      <div className="mb-3 text-sm text-gray-600 italic">{r.rec}</div>

      <div className="flex items-center justify-between text-xs text-gray-400 mt-4">
        <div>{r.user}</div>
        <div>{r.time}</div>
      </div>

      <button onClick={() => onViewDetails(r)} className="mt-4 w-full inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">
        Ver detalles
      </button>
    </article>
  );
}

function MapComponent({ reports, highlightReportId, enableClickToSet, onMapClick, tempMarker }) {
  const mapRef = React.useRef(null);
  const mapInstance = React.useRef(null);
  const markers = React.useRef({});
  // highlightReportId se manejar√° desde App mediante prop para abrir popup y centrar
  const propsRef = React.useRef({});

  const getMarkerColor = (status) => {
    switch(status) {
      case 'Buena': return '#22c55e';
      case 'Regular': return '#eab308';
      case 'Mala': return '#f97316';
      case 'Cerrada': return '#ef4444';
      default: return '#6b7280';
    }
  };

  const createMarkerIcon = (color) => {
    return L.divIcon({
      html: `
        <div style="
          background-color: ${color};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          color: white;
          font-size: 16px;
        ">
          üìç
        </div>
      `,
      iconSize: [36, 36],
      className: 'custom-marker'
    });
  };

  React.useEffect(() => {
    // Esperar a que Leaflet est√© disponible y el DOM est√© listo
    if (!window.L || !mapRef.current) return;

    // Inicializar mapa
    if (!mapInstance.current) {
      mapInstance.current = L.map(mapRef.current).setView([5.6929, -75.7519], 8);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19,
        minZoom: 5
      }).addTo(mapInstance.current);
    }

    // Limpiar marcadores antiguos
    Object.values(markers.current).forEach(marker => {
      mapInstance.current.removeLayer(marker);
    });
    markers.current = {};

    // Agregar marcadores de reportes
    reports.forEach(report => {
      if (report.lat && report.lng) {
        const marker = L.marker([report.lat, report.lng], {
          icon: createMarkerIcon(getMarkerColor(report.status))
        }).bindPopup(`
          <div style="font-size: 12px; width: 200px;">
            <strong>${report.title}</strong><br/>
            <span style="display:inline-block; margin: 4px 0; padding: 4px 8px; background-color: ${getMarkerColor(report.status)}; color: white; border-radius: 4px; font-weight: bold; font-size: 11px;">
              ${report.status}
            </span><br/>
            <small><strong>Ubicaci√≥n:</strong> ${report.location}</small><br/>
            <small><strong>Estado:</strong> ${report.message.substring(0, 50)}...</small><br/>
            <small><strong>Usuario:</strong> ${report.user}</small><br/>
            <small><strong>Reportado:</strong> ${report.time}</small>
          </div>
        `).addTo(mapInstance.current);

        markers.current[report.id] = marker;
      }
    });

    // si hay marcador temporal (tempMarker) mostrarlo
    if (window.L && tempMarker && tempMarker.lat && tempMarker.lng) {
      // quitar previo
      if (markers.current.__temp) mapInstance.current.removeLayer(markers.current.__temp);
      const m = L.marker([tempMarker.lat, tempMarker.lng], { opacity: 0.85 }).addTo(mapInstance.current);
      markers.current.__temp = m;
    }
  }, [reports]);

    // efecto para abrir popup de un reporte recien creado y centrar mapa
  React.useEffect(() => {
    if (!window.L || !mapInstance.current) return;
    const id = highlightReportId || propsRef.current.highlightReportId;
    if (!id) return;
    const marker = markers.current[id];
    if (marker) {
      try {
        marker.openPopup();
        mapInstance.current.setView(marker.getLatLng(), Math.max(mapInstance.current.getZoom(), 12));
      } catch (err) {
        console.warn('No se pudo abrir popup para el reporte', id, err);
      }
    }
    // limpiar el highlight en la referencia para evitar re-aperturas
    propsRef.current.highlightReportId = null;
  }, [reports, highlightReportId]);

  // manejar clicks en el mapa para fijar coordenadas cuando est√© activado
  React.useEffect(() => {
    if (!window.L || !mapInstance.current) return;
    function onClick(e){
      if (!enableClickToSet) return;
      const { lat, lng } = e.latlng;
      if (typeof onMapClick === 'function') onMapClick({ lat, lng });
    }
    mapInstance.current.on('click', onClick);
    return () => mapInstance.current.off('click', onClick);
  }, [enableClickToSet, onMapClick]);

  return (
    <div 
      ref={mapRef} 
      style={{
        width: '100%',
        height: '500px',
        borderRadius: '12px',
        boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
        border: '1px solid #e5e7eb',
        marginBottom: '2rem'
      }}
    ></div>
  );
}

function ReportDetailsModal({ report, onClose }) {
  if (!report) return null;
  return (
    <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-8 relative">
        <button onClick={onClose} className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition">‚úï</button>
        <h2 className="text-2xl font-bold mb-4 text-blue-700">Detalles del reporte</h2>
        <div className="mb-2">
          <span className="font-bold text-gray-700">V√≠a:</span> {report.title}
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Estado:</span> <span style={{color: '#fff', backgroundColor: '#2563eb', borderRadius: '6px', padding: '2px 8px'}}>{report.status}</span>
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Ubicaci√≥n:</span> {report.location}
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Descripci√≥n:</span> {report.message}
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Recomendaciones:</span> {report.rec}
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Usuario:</span> {report.user}
        </div>
        <div className="mb-2">
          <span className="font-bold text-gray-700">Fecha:</span> {report.time}
        </div>
        {/* Mostrar foto/video si existe */}
        {report.files && report.files.length > 0 && (
          <div className="mt-4">
            <span className="font-bold text-gray-700 block mb-2">Evidencia:</span>
            {report.files.map((file, idx) => (
              file.type.startsWith('image') ? (
                <img key={idx} src={file.data || file.url} alt="Evidencia" className="rounded-lg mb-2 w-full max-h-48 object-cover" />
              ) : (
                <video key={idx} controls className="rounded-lg mb-2 w-full max-h-48">
                  <source src={file.data || file.url} type={file.type} />
                  Tu navegador no soporta video.
                </video>
              )
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

function AdminPanel({ reports, setReports, users, setUsers, roads, onClose, apiAvailable }) {
  const [tab, setTab] = React.useState('reports');
  const [editing, setEditing] = React.useState(null);

  const approveToggle = async (id) => {
    const report = reports.find(r => r.id === id);
    const updated = { ...report, approved: !report.approved };
    setReports(prev => prev.map(r => r.id === id ? updated : r));

    // Enviar cambio al servidor
    if (apiAvailable) {
      try {
  const res = await fetch(`/.netlify/functions/reports?id=${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updated)
        });
        if (!res.ok) {
          console.warn('Error al actualizar en servidor');
        }
      } catch (err) {
        console.warn('Error de conexi√≥n:', err.message);
      }
    }
  };

  const removeReport = async (id) => {
    if (!confirm('¬øEliminar este reporte?')) return;
    setReports(prev => prev.filter(r => r.id !== id));

    // Enviar eliminaci√≥n al servidor
    if (apiAvailable) {
      try {
  const res = await fetch(`/.netlify/functions/reports?id=${id}`, {
          method: 'DELETE'
        });
        if (!res.ok) {
          console.warn('Error al eliminar en servidor');
        }
      } catch (err) {
        console.warn('Error de conexi√≥n:', err.message);
      }
    }
  };

  const editReport = async (r) => {
    const newMsg = prompt('Editar descripci√≥n', r.message);
    if (newMsg == null) return;
    const updated = { ...r, message: newMsg };
    setReports(prev => prev.map(rep => rep.id === r.id ? updated : rep));

    // Enviar cambio al servidor
    if (apiAvailable) {
      try {
  const res = await fetch(`/.netlify/functions/reports?id=${r.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updated)
        });
        if (!res.ok) {
          console.warn('Error al actualizar en servidor');
        }
      } catch (err) {
        console.warn('Error de conexi√≥n:', err.message);
      }
    }
  };

  const blockToggle = async (name) => {
    const user = users.find(u => u.name === name);
    const updated = { ...user, blocked: !user.blocked };
    setUsers(prev => prev.map(u => u.name === name ? updated : u));

    // Enviar cambio al servidor
    if (apiAvailable) {
      try {
  const res = await fetch(`/.netlify/functions/users?name=${encodeURIComponent(name)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updated)
        });
        if (!res.ok) {
          console.warn('Error al actualizar usuario en servidor');
        }
      } catch (err) {
        console.warn('Error de conexi√≥n:', err.message);
      }
    }
  };

  // Estad√≠sticas simples
  const stats = React.useMemo(() => {
    const byStatus = reports.reduce((acc, r) => { acc[r.status] = (acc[r.status] || 0) + 1; return acc; }, {});
    const byRoad = reports.reduce((acc, r) => { acc[r.title] = (acc[r.title] || 0) + 1; return acc; }, {});
    const topRoads = Object.entries(byRoad).sort((a,b)=>b[1]-a[1]).slice(0,5);
    return { byStatus, topRoads };
  }, [reports]);

  return (
    <div className="fixed inset-0 bg-black/50 flex items-start justify-center z-50 p-4 overflow-auto">
      <div className="bg-white rounded-lg shadow-2xl w-full max-w-4xl p-6 relative">
        <button onClick={onClose} className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full transition">‚úï</button>
        <h2 className="text-2xl font-bold mb-4">Panel de Administraci√≥n</h2>
        <div className="mb-4">
          <button onClick={()=>setTab('reports')} className={`px-3 py-1 mr-2 rounded ${tab==='reports' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>Reportes</button>
          <button onClick={()=>setTab('users')} className={`px-3 py-1 mr-2 rounded ${tab==='users' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>Usuarios</button>
          <button onClick={()=>setTab('stats')} className={`px-3 py-1 rounded ${tab==='stats' ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>Estad√≠sticas</button>
        </div>

        {tab === 'reports' && (
          <div>
            <h3 className="font-semibold mb-3">Reportes recientes</h3>
            <div className="grid gap-3">
              {reports.map(r => (
                <div key={r.id} className="p-3 border rounded flex items-start justify-between">
                  <div>
                    <div className="font-bold">{r.title} <span className="text-xs text-gray-500">{r.location}</span></div>
                    <div className="text-sm text-gray-700">{r.message}</div>
                    <div className="text-xs text-gray-400">Usuario: {r.user} ¬∑ {r.time}</div>
                  </div>
                  <div className="flex flex-col items-end gap-2">
                    <button onClick={() => approveToggle(r.id)} className={`px-3 py-1 rounded ${r.approved ? 'bg-green-500 text-white' : 'bg-gray-100'}`}>{r.approved ? 'Aprobado' : 'Aprobar'}</button>
                    <button onClick={() => editReport(r)} className="px-3 py-1 rounded bg-yellow-100">Editar</button>
                    <button onClick={() => removeReport(r.id)} className="px-3 py-1 rounded bg-red-500 text-white">Eliminar</button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {tab === 'users' && (
          <div>
            <h3 className="font-semibold mb-3">Usuarios registrados</h3>
            <div className="grid gap-2">
              {users.map(u => (
                <div key={u.name} className="p-3 border rounded flex items-center justify-between">
                  <div>
                    <div className="font-bold">{u.name}</div>
                    <div className="text-xs text-gray-500">Rol: {u.role} ¬∑ {u.blocked ? 'Bloqueado' : 'Activo'}</div>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => blockToggle(u.name)} className={`px-3 py-1 rounded ${u.blocked ? 'bg-green-500 text-white' : 'bg-gray-100'}`}>{u.blocked ? 'Desbloquear' : 'Bloquear'}</button>
                    <button onClick={() => setUsers(prev => prev.map(x => x.name===u.name ? {...x, role: x.role==='user' ? 'admin' : 'user'} : x))} className="px-3 py-1 rounded bg-blue-100">Cambiar rol</button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {tab === 'stats' && (
          <div>
            <h3 className="font-semibold mb-3">Estad√≠sticas</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="p-3 border rounded">
                <h4 className="font-bold mb-2">Reportes por estado</h4>
                {Object.entries(stats.byStatus).map(([k,v]) => (
                  <div key={k} className="flex justify-between text-sm"><span>{k}</span><span>{v}</span></div>
                ))}
              </div>
              <div className="p-3 border rounded">
                <h4 className="font-bold mb-2">V√≠as con m√°s reportes</h4>
                {stats.topRoads.map(([name, count]) => (
                  <div key={name} className="flex justify-between text-sm"><span>{name}</span><span>{count}</span></div>
                ))}
              </div>
            </div>
          </div>
        )}

      </div>
    </div>
  );
}

function App() {
  const [showLogin, setShowLogin] = React.useState(false);
  const [showRegister, setShowRegister] = React.useState(false);
  const [showReport, setShowReport] = React.useState(false);
  const [isAuthenticated, setIsAuthenticated] = React.useState(false);
  const [isAdmin, setIsAdmin] = React.useState(false);
  const [userName, setUserName] = React.useState('');
  const [roads, setRoads] = React.useState(roadsData);
  const [reports, setReports] = React.useState(reportsData);
  const [activeTab, setActiveTab] = React.useState('all');
  const [showDetails, setShowDetails] = React.useState(null);
  const [showAbout, setShowAbout] = React.useState(false);
  const [recentReports, setRecentReports] = React.useState([]); // reportes hechos en la sesi√≥n
  const [showMenu, setShowMenu] = React.useState(false); // men√∫ hamburguesa m√≥vil
  const [users, setUsers] = React.useState(() => {
    // Inicializar con usuarios que aparecen en los reportes
    const uniq = Array.from(new Set(reportsData.map(r => r.user))).map(u => ({ name: u, blocked: false, role: 'user' }));
    return uniq;
  });
  const [highlightReportId, setHighlightReportId] = React.useState(null);
  const [showAdminPanel, setShowAdminPanel] = React.useState(false);
  const [mapClickMode, setMapClickMode] = React.useState(false); // true cuando el usuario activa 'marcar en mapa'
  const [pendingCoords, setPendingCoords] = React.useState(null); // {lat,lng} seleccionadas desde el mapa
  const [apiAvailable, setApiAvailable] = React.useState(false); // true si el servidor est√° disponible
  const [selectedCoords, setSelectedCoords] = React.useState(null); // {lat,lng} para llenar el formulario

  // Cargar datos del servidor al inicializar
  React.useEffect(() => {
    const loadFromServer = async () => {
      try {
  const res = await fetch('/.netlify/functions/reports');
        if (res.ok) {
          const data = await res.json();
          setReports(data);
          setApiAvailable(true);
        }
      } catch (err) {
        console.warn('Servidor no disponible, usando datos en memoria:', err.message);
        setApiAvailable(false);
      }
    };
    loadFromServer();
  }, []);

  // Funci√≥n para a√±adir reporte y actualizar v√≠a si aplica
  const handleNewReport = async (reportData) => {
    // Crear nuevo reporte con id
    const newId = Math.max(...reports.map(r => r.id), 0) + 1;

    // intentar asignar coordenadas por defecto seg√∫n la v√≠a seleccionada
    let lat = reportData.lat;
    let lng = reportData.lng;
    const roadId = parseInt(reportData.road);
    if ((!lat || !lng) && roadCoords[roadId]) {
      // small jitter para no superponer marcadores exactos
      const jitter = () => (Math.random() - 0.5) * 0.02;
      lat = roadCoords[roadId].lat + jitter();
      lng = roadCoords[roadId].lng + jitter();
    }

    const newReport = {
      id: newId,
      ...reportData,
      user: userName,
      time: 'Hace 0 min',
      lat,
      lng,
      approved: false
    };

    // Eliminar reportes antiguos de la MISMA v√≠a Y MISMA ubicaci√≥n (km)
    const filteredReports = reports.filter(r => 
      !(r.title === reportData.title && r.location === reportData.location)
    );
    const updatedReports = [newReport, ...filteredReports];
    setReports(updatedReports);
    setRecentReports([newReport, ...recentReports]);

    // actualizar estado de la v√≠a si aplica
    const roadIndex = roads.findIndex(r => r.id === roadId);
    if (roadIndex !== -1) {
      const updatedRoads = [...roads];
      updatedRoads[roadIndex].status = reportData.status;
      updatedRoads[roadIndex].updated = new Date().toLocaleString('es-ES');
      setRoads(updatedRoads);
    }

    // si el report creado tiene coordenas, pedir a MapComponent que lo resalte
    setHighlightReportId(newId);
    setShowReport(false);
    // si ven√≠amos en modo marcar en mapa, desactivar y limpiar pending coords
    setMapClickMode(false);
    setPendingCoords(null);
    // quitar highlight luego de un instante para evitar reaperturas repetidas
    setTimeout(() => setHighlightReportId(null), 1500);

    // Enviar al servidor si est√° disponible
    if (apiAvailable) {
      try {
  const res = await fetch('/.netlify/functions/reports', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newReport)
        });
        if (!res.ok) {
          console.warn('Error al guardar en servidor:', res.statusText);
        }
      } catch (err) {
        console.warn('Error de conexi√≥n al guardar reporte:', err.message);
      }
    }
  };

  // Manejar click en mapa para seleccionar coordenadas en el formulario
  const handleMapClick = ({ lat, lng }) => {
    setSelectedCoords({ lat, lng });
    setMapClickMode(false);
    // Hacer scroll al campo de latitud para confirmar que se seleccion√≥
    setTimeout(() => {
      const latInput = document.getElementById('report-latitude');
      if (latInput) latInput.focus();
    }, 100);
  };

  // Si no autenticado, muestra header fullscreen
  if (!isAuthenticated) {
    return (
      <div className="w-full h-screen bg-cover bg-center flex flex-col items-center justify-center relative overflow-hidden" 
           style={{backgroundImage: "url('img/logo.jpeg')"}}>
        {/* Overlay oscuro */}
        <div className="absolute inset-0 bg-black/40"></div>
        
        {/* Contenido centrado */}
        <div className="relative z-10 text-center text-white px-4 max-w-2xl">
          <div className="mb-8">
            <img src="img/logo.jpeg" alt="V√≠as del Choc√≥" className="h-20 rounded-lg shadow-lg mx-auto mb-6" />
          </div>
          <h1 className="text-6xl md:text-7xl font-black drop-shadow-2xl mb-4">V√≠as del Choc√≥</h1>
          <p className="text-xl md:text-2xl text-gray-100 drop-shadow-lg mb-12">Informaci√≥n actualizada sobre el estado de las carreteras</p>
          
          {/* Botones de auth */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <button 
              onClick={() => setShowLogin(true)}
              className="px-8 py-3 bg-white text-black font-bold rounded-lg shadow-lg hover:bg-gray-100 transition text-lg"
            >
              Iniciar sesi√≥n
            </button>
            <button 
              onClick={() => setShowRegister(true)}
              className="px-8 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 transition text-lg"
            >
              Registrarse
            </button>
          </div>
        </div>

        {/* Modales */}
        {showLogin && (
          <LoginModal 
            onClose={() => setShowLogin(false)} 
            onShowRegister={() => { setShowLogin(false); setShowRegister(true); }}
            onLogin={(email) => { 
              const isAdminUser = String(email).toLowerCase().split('@')[0] === 'admin';
              setIsAuthenticated(true); 
              setUserName(email); 
              setIsAdmin(isAdminUser);
              localStorage.setItem('currentUser', email);
              setShowLogin(false); 
            }}
          />
        )}
        {showRegister && (
          <RegisterModal 
            onClose={() => setShowRegister(false)}
            onRegister={(name, email) => { 
              const isAdminUser = String(email).toLowerCase().split('@')[0] === 'admin';
              setIsAuthenticated(true); 
              setUserName(name); 
              setIsAdmin(isAdminUser);
              // Guardar el email como usuario actual (consistente para admin check)
              localStorage.setItem('currentUser', email);
              const newUser = { name, email, blocked: false, role: isAdminUser ? 'admin' : 'user' };
              setUsers(prev => [...prev, newUser]);
              // Enviar usuario al servidor si est√° disponible
              if (apiAvailable) {
                fetch('/.netlify/functions/users', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(newUser)
                }).catch(err => console.warn('Error al guardar usuario en servidor:', err.message));
              }
              setShowRegister(false); 
            }}
          />
        )}
      </div>
    );
  }

  // Si autenticado, muestra contenido principal
  return (
    <div className="app min-h-screen bg-gray-50">
      {/* Header con logo de fondo */}
      <div className="relative w-full h-56 md:h-72 flex items-center justify-center" style={{backgroundImage: "url('img/LOGOCHCOCVIA.jpg')", backgroundSize: 'cover', backgroundPosition: 'center'}}>
        <div className="absolute inset-0 bg-black/30"></div>
        <div className="relative z-10 text-center w-full">
          <h1 className="text-5xl md:text-6xl font-black text-white drop-shadow-lg mb-2">V√≠as del Choc√≥</h1>
          <p className="text-lg md:text-2xl text-gray-100 drop-shadow mb-4">Informaci√≥n actualizada sobre el estado de las carreteras</p>
        </div>
        {/* Men√∫ flotante sticky */}
        <nav className="fixed top-0 left-0 w-full bg-white/90 shadow-lg backdrop-blur-md flex items-center justify-between px-4 py-3 md:px-12 md:py-4" style={{borderBottom: '2px solid #2563eb', zIndex: 10000}}>
          <div className="flex items-center gap-3">
            <span className="font-black text-xl md:text-2xl text-blue-700">V√≠as del Choc√≥</span>
          </div>
          <div className="hidden md:flex gap-8 items-center">
            <button className={`font-bold px-4 py-2 rounded-lg transition ${activeTab==='all' ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'}`} onClick={()=>setActiveTab('all')}>Todos los Reportes</button>
            <button className={`font-bold px-4 py-2 rounded-lg transition ${activeTab==='recent' ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'}`} onClick={()=>setActiveTab('recent')}>Reportes Recientes</button>
            <button className="font-bold px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100" onClick={()=>setShowAbout(true)}>Sobre nosotros</button>
            <div className="w-px h-6 bg-gray-300"></div>
            <div className="flex items-center gap-3">
              <span className="text-sm font-semibold text-gray-700">{userName}</span>
              {isAdmin && (
                <button onClick={()=>setShowAdminPanel(true)} className="font-semibold px-3 py-1 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition inline-block">Panel Admin</button>
              )}
              <button onClick={()=>{setIsAuthenticated(false); setShowMenu(false);}} className="font-bold px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition">Cerrar Sesi√≥n</button>
            </div>
          </div>
          {/* Men√∫ hamburguesa m√≥vil */}
          <div className="md:hidden">
            <button onClick={()=>setShowMenu(m=>!m)} className="p-2 rounded-lg bg-blue-100 text-blue-700">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-7 h-7"><path strokeLinecap="round" strokeLinejoin="round" d="M4.75 6.75h14.5M4.75 12h14.5M4.75 17.25h14.5" /></svg>
            </button>
            {showMenu && (
              <div className="absolute top-16 left-0 w-full bg-white shadow-lg flex flex-col gap-2 p-4" style={{zIndex: 10000}}>
                <button className={`font-bold px-4 py-2 rounded-lg transition ${activeTab==='all' ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'}`} onClick={()=>{setActiveTab('all');setShowMenu(false);}}>Todos los Reportes</button>
                <button className={`font-bold px-4 py-2 rounded-lg transition ${activeTab==='recent' ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-100'}`} onClick={()=>{setActiveTab('recent');setShowMenu(false);}}>Reportes Recientes</button>
                <button className="font-bold px-4 py-2 rounded-lg text-gray-700 hover:bg-gray-100" onClick={()=>{setShowAbout(true);setShowMenu(false);}}>Sobre nosotros</button>
                <div className="border-t border-gray-200 my-2"></div>
                <div className="px-4 py-2">
                  <p className="text-xs text-gray-500 mb-2">Sesi√≥n: <span className="font-semibold text-gray-700">{userName}</span></p>
                </div>
                {isAdmin && (
                  <button onClick={()=>{ setShowAdminPanel(true); setShowMenu(false); }} className="font-semibold px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition text-left mb-2 inline-block w-full text-center">Panel Admin</button>
                )}
                <button onClick={()=>{setIsAuthenticated(false); setShowMenu(false);}} className="font-bold px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600 transition text-left">üö™ Cerrar Sesi√≥n</button>
              </div>
            )}
          </div>
        </nav>
      </div>

      {/* Modal Sobre Nosotros */}
      {showAbout && (
        <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl max-w-md w-full p-8 relative">
            <button onClick={() => setShowAbout(false)} className="absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition">‚úï</button>
            <h2 className="text-3xl font-bold mb-4 text-blue-700">Sobre nosotros</h2>
            <p className="mb-4 text-gray-700">Esta p√°gina fue creada para informar a la comunidad sobre el estado de las carreteras del Choc√≥ en tiempo real. Surgi√≥ como iniciativa de apoyo a los viajeros y habitantes de la regi√≥n, permitiendo reportar y consultar el estado de las v√≠as de manera colaborativa.</p>
            <div className="mb-2">
              <span className="font-bold text-blue-700">Due√±o:</span> Luis Alexander
            </div>
            <div className="mb-2">
              <span className="font-bold text-blue-700">Estudiante:</span> Universidad Uniclaretiana
            </div>
            <div className="mb-2">
              <span className="font-bold text-blue-700">Facultad:</span> Ingenier√≠a en Sistemas
            </div>
            <div className="mb-2">
              <span className="font-bold text-blue-700">Semestre:</span> Segundo semestre
            </div>
            <p className="mt-4 text-gray-600 text-sm">¬°Gracias por usar la plataforma y contribuir con tus reportes!</p>
          </div>
        </div>
      )}

      <main className="flex-1 container mx-auto px-2 md:px-8 py-8">
        <Stats />
        
        {/* Mapa en tiempo real */}
        <section className="mb-12">
          <div className="mb-4">
            <h2 className="text-3xl font-bold text-gray-800">üìç Mapa en Tiempo Real</h2>
            <p className="text-gray-600 mt-2">Visualiza la ubicaci√≥n de todos los reportes de v√≠as en el Choc√≥</p>
          </div>
          <MapComponent
            reports={reports}
            highlightReportId={highlightReportId}
            enableClickToSet={mapClickMode}
            onMapClick={handleMapClick}
            tempMarker={selectedCoords}
          />
          
          {/* Leyenda del mapa */}
          <div className="mt-4 bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <h3 className="font-bold text-gray-800 mb-3">Leyenda de Estados:</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
              <div className="flex items-center gap-2">
                <div style={{width: '20px', height: '20px', backgroundColor: '#22c55e', borderRadius: '50%'}}></div>
                <span className="text-sm text-gray-700">Buena</span>
              </div>
              <div className="flex items-center gap-2">
                <div style={{width: '20px', height: '20px', backgroundColor: '#eab308', borderRadius: '50%'}}></div>
                <span className="text-sm text-gray-700">Regular</span>
              </div>
              <div className="flex items-center gap-2">
                <div style={{width: '20px', height: '20px', backgroundColor: '#f97316', borderRadius: '50%'}}></div>
                <span className="text-sm text-gray-700">Mala</span>
              </div>
              <div className="flex items-center gap-2">
                <div style={{width: '20px', height: '20px', backgroundColor: '#ef4444', borderRadius: '50%'}}></div>
                <span className="text-sm text-gray-700">Cerrada</span>
              </div>
            </div>
          </div>
        </section>
        
        <div className="flex flex-col items-center mt-8 mb-6">
          <button 
            onClick={() => setShowReport(true)}
            className="px-6 md:px-8 py-3 md:py-4 bg-blue-600 text-white font-bold rounded-lg shadow-lg hover:bg-blue-700 transition duration-300 flex items-center gap-3 text-lg"
            style={{boxShadow:'0 6px 20px 0 rgba(37,99,235,0.12)'}}
          >
            {/* Icono SVG documento + l√°piz */}
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-5 h-5" style={{color:'white'}}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 20h9" />
              <path strokeLinecap="round" strokeLinejoin="round" d="M16.5 3.5L20.5 7.5 8 20H4v-4L16.5 3.5z" />
            </svg>
            Hacer Reporte
          </button>

          {/* Botones de filtro - debajo del bot√≥n principal */}
          <div className="mt-4 bg-white/60 rounded-xl p-1 shadow-sm flex items-center gap-1" style={{border:'1px solid rgba(0,0,0,0.04)'}}>
            <button onClick={() => setActiveTab('all')} className={`px-5 py-2 rounded-lg font-semibold transition ${activeTab==='all' ? 'bg-white text-gray-800' : 'text-gray-500 hover:bg-gray-50'}`}>
              Todas las V√≠as
            </button>
            <button onClick={() => setActiveTab('recent')} className={`px-5 py-2 rounded-lg font-semibold transition ${activeTab==='recent' ? 'bg-white text-gray-800' : 'text-gray-500 hover:bg-gray-50'}`}>
              Reportes Recientes
            </button>
          </div>
        </div>
        {/* Mostrar reportes */}
        {activeTab === 'all' && (
          <section className="py-6">
            <h2 className="text-2xl font-bold mb-6 text-gray-800">Reportes de todas las v√≠as</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {reports.length > 0 ? (
                reports.map(r => <Report key={r.id} r={r} onViewDetails={setShowDetails} />)
              ) : (
                <div className="text-center py-8 text-gray-500">
                  <p className="text-lg">No hay reportes disponibles</p>
                </div>
              )}
            </div>
          </section>
        )}
        {activeTab === 'recent' && (
          <section className="py-6">
            <h2 className="text-2xl font-bold mb-6 text-gray-800">Reportes recientes</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {recentReports.length > 0 ? (
                recentReports.map(r => <Report key={r.id} r={r} onViewDetails={setShowDetails} />)
              ) : (
                <div className="text-center py-8 text-gray-500">
                  <p className="text-lg">No hay reportes recientes. Usa "Hacer Reporte" para crear uno.</p>
                </div>
              )}
            </div>
          </section>
        )}
        {/* Modal de detalles de reporte */}
        <ReportDetailsModal report={showDetails} onClose={()=>setShowDetails(null)} />
        {showAdminPanel && (
          <AdminPanel reports={reports} setReports={setReports} users={users} setUsers={setUsers} roads={roads} onClose={()=>setShowAdminPanel(false)} apiAvailable={apiAvailable} />
        )}
      </main>

      {/* Modal de Reporte */}
      {showReport && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4" style={{zIndex: 9999}}>
          <div className="bg-gray-50 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 md:p-8 relative" style={{backgroundColor:'#f8fafc'}}>
            <button 
              onClick={() => setShowReport(false)}
              className="sticky top-0 absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-full transition bg-white"
              style={{zIndex: 10}}
            >
              ‚úï
            </button>
            
            <h2 className="text-2xl md:text-3xl font-bold mb-6 pr-8" style={{color:'#030213'}}>Hacer Reporte</h2>
            <form onSubmit={async (e) => {
              e.preventDefault();
              const form = e.target;
              const filesInput = form.files;
              const files = Array.from(filesInput.files || []);
              
              // Convertir archivos a base64
              const filesData = [];
              for (const file of files) {
                const reader = new FileReader();
                const fileBase64 = await new Promise((resolve) => {
                  reader.onload = () => resolve(reader.result);
                  reader.readAsDataURL(file);
                });
                filesData.push({
                  name: file.name,
                  type: file.type,
                  data: fileBase64
                });
              }
              
              const lat = parseFloat(form.latitude.value);
              const lng = parseFloat(form.longitude.value);
              
              handleNewReport({
                title: form.road.options[form.road.selectedIndex].text,
                road: form.road.value,
                status: form.status.value,
                location: form.location.value,
                message: form.comment.value,
                rec: form.recommendations.value,
                lat: lat || null,
                lng: lng || null,
                files: filesData
              });
            }} className="space-y-4">
              <div>
                <label htmlFor="report-road" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Selecciona la V√≠a</label>
                <select id="report-road" name="road" className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}}>
                  <option value="">Selecciona una v√≠a</option>
                  {roads.map(r => <option key={r.id} value={r.id}>{r.title}</option>)}
                </select>
              </div>

              <div>
                <label htmlFor="report-status" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Estado Actual</label>
                <select id="report-status" name="status" className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}}>
                  <option value="">Selecciona el estado</option>
                  <option value="Buena">Buena - Transitable sin problemas</option>
                  <option value="Regular">Regular - Algunos baches o demoras</option>
                  <option value="Mala">Mala - Muy deteriorada</option>
                  <option value="Cerrada">Cerrada - Intransitable</option>
                </select>
              </div>

              <div>
                <label htmlFor="report-location" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Ubicaci√≥n Espec√≠fica (Kil√≥metro)</label>
                <input type="text" id="report-location" name="location" placeholder="Ej: Km 45 - 48" className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}} />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label htmlFor="report-latitude" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Latitud</label>
                  <input type="number" id="report-latitude" name="latitude" placeholder="5.6929" step="0.0001" defaultValue={selectedCoords?.lat || ''} className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}} />
                </div>
                <div>
                  <label htmlFor="report-longitude" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Longitud</label>
                  <input type="number" id="report-longitude" name="longitude" placeholder="-75.7519" step="0.0001" defaultValue={selectedCoords?.lng || ''} className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}} />
                </div>
              </div>

              <button
                type="button"
                onClick={() => setMapClickMode(!mapClickMode)}
                className={`w-full px-4 py-2 rounded-lg font-semibold transition ${mapClickMode ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}
              >
                {mapClickMode ? '‚ùå Cancelar Selecci√≥n en Mapa' : 'üìç Seleccionar en Mapa'}
              </button>

              <div>
                <label htmlFor="report-comment" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Descripci√≥n del Estado</label>
                <textarea id="report-comment" name="comment" rows="3" placeholder="Describe el problema..." className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}}></textarea>
              </div>

              <div>
                <label htmlFor="report-recommendations" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Recomendaciones</label>
                <textarea id="report-recommendations" name="recommendations" rows="3" placeholder="Ej: Reducir velocidad..." className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition text-sm md:text-base" style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}}></textarea>
              </div>
             
              <div>
                <label htmlFor="report-files" className="block text-sm font-semibold mb-2" style={{color:'#030213'}}>Adjuntar Archivos (Fotos/Videos)</label>
                <input 
                  type="file" 
                  id="report-files" 
                  name="files" 
                  multiple 
                  accept="image/*,video/*"
                  className="w-full px-3 md:px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition cursor-pointer text-sm md:text-base"
                  style={{borderColor:'#bfdbfe', backgroundColor:'white', color:'#1a1a1a'}}
                />
                <p className="text-xs mt-1" style={{color:'#717182'}}>Soporta im√°genes y videos. M√°ximo 5 archivos.</p>
              </div>

              <div className="flex gap-2 justify-end pt-4">
                <button type="button" onClick={() => setShowReport(false)} className="px-4 py-2 font-semibold rounded-lg transition text-sm md:text-base" style={{color:'#717182', backgroundColor:'#efefff'}}>
                  Cancelar
                </button>
                <button type="submit" className="px-6 py-2 text-white font-bold rounded-lg transition text-sm md:text-base" style={{backgroundColor:'#030213'}}>
                  Enviar Reporte
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      <footer className="bg-gray-900 text-white py-12 mt-12">
        <div className="max-w-6xl mx-auto px-4">
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 mb-8">
            {/* Sobre */}
            <div>
              <h4 className="text-lg font-bold mb-4">Sobre Nosotros</h4>
              <p className="text-gray-400 text-sm">V√≠as del Choc√≥: Informaci√≥n vial en tiempo real para mejorar la seguridad.</p>
            </div>

            {/* Enlaces */}
            <div>
              <h4 className="text-lg font-bold mb-4">Enlaces</h4>
              <ul className="space-y-2 text-gray-400 text-sm">
                <li><button onClick={() => setShowAbout(true)} className="hover:text-white">Sobre Nosotros</button></li>
                <li><a href="#" className="hover:text-white">T√©rminos de Uso</a></li>
                <li><a href="#" className="hover:text-white">Privacidad</a></li>
              </ul>
            </div>

            {/* Contacto */}
            <div>
              <h4 className="text-lg font-bold mb-4">Contacto</h4>
              <p class="text-gray-400 text-sm">
              üìß <a href="mailto:Alrxandermaturana76@gmail.com" class="text-gray-400 hover:text-blue-400">
                Alrxandermaturana76@gmail.com
              </a>
            </p>

            <p class="text-gray-400 text-sm">
              üìû <a href="https://wa.me/573145312045" target="_blank" class="text-gray-400 hover:text-green-500">
                +57 314 531 2045
              </a>
            </p>

              <p className="text-gray-400 text-sm">üìç Quibd√≥, Choc√≥</p>
            </div>

            {/* Redes Sociales */}
            <div>
              <h4 className="text-lg font-bold mb-4">S√≠guenos</h4>
              <div className="flex gap-4">
                <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-2xl">f</a>
                <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 text-2xl">ùïè</a>
                <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" className="text-pink-400 hover:text-pink-300 text-2xl">üì∑</a>
                 
              </div>
            </div>
          </div>

          <hr className="border-gray-700 mb-6" />
          <div className="text-center text-gray-400 text-sm">
            <p>&copy; 2025 V√≠as del Choc√≥. Realizado por <span className="text-blue-400 font-bold">luisito</span> | Todos los derechos reservados.</p>
          </div>
        </div>
      </footer>
      </div>
     );
  }
      
// Montaje (React y ReactDOM est√°n disponibles globalmente a trav√©s de los scripts UMD cargados en index.html)
const appContainer = document.getElementById('app');
if (appContainer) {
  ReactDOM.createRoot(appContainer).render(<App />);
} else {
  console.error('No se encontr√≥ #app');
}
// --- fin App.jsx inline ---
  </script>
</body>
</html>